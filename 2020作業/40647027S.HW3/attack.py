import requests
import libnum
import decimal

N = 20330970518755266242385905909493999137973424517956750150773387949450532738688140473016222471696353578971086244369854380559140307733766358995413733184270019263360966196480889892663449165581262567418515172910299228349764975639022173337717299671010360499385345258618681931950804787900352965945845764611738623330333991461000238591512750434491144339028770929223044620312099262465034253568878440783320799163740718510059832988003082752355931321805914693636091553425020056741155485595996089729505271434927528288363505735195072563272004104479612256661159085577310689018439362584786110537353301294577002586849490834964662377009
e = 176017195937730623562123747592078013189155197074053280649770136474672968778215745823517885186913756941022137245391137597807350100567017396357885051013778874401683908206146763549324783662154975115658507034180653906388362323548765829068065774694214943095348097082200118107056345501727632545607469759685883132593
c = 19803286414495981330870450369377715872676019761582054037317596577566473104382272273947388256197615394874292393112202628235903476124731068348505497099290573628894182977809740202619294758259872574785048616209131813280134942992152396562435381278031278003714089520128653354818296884091657183101776596985640911937527560903756271740659813806181439463783511199223171164610626514702610107528212587902037123680503490526074604074867706958117048387006821204720300245174495357190304469898279664415140040595254468149735767539024407285843623402381866131157763950114862821892112559155040447429428354098448851315373773712303264478559
t = pow(2, e, N)

attack_url = "http://140.122.185.173:8080/oracle/"

k = N.bit_length()

decimal.getcontext().prec = k
lower = decimal.Decimal(0)
upper = decimal.Decimal(N)

c = (c * t) % N
for i in range(k):
    possible_plaintext = (lower + upper) / 2
    req = requests.get(attack_url + str(c))
    flag = 0 if req.text == "0" else 1
    if not flag:
        upper = possible_plaintext
    else:
        lower = possible_plaintext
    c = (c * t) % N 
    print(i, flag, int(upper - lower))

print(int(upper))
#m = 9035027108107041725244194194803886392473621489149281721453191334646433155097184208159028746568837371307106930869250054361027322217584471624529285618495747285254374399330235723988933305162267987725754106606463536239953838594955869908325937345640259140670379488046
print(libnum.n2s(int(upper)))
# It was the best of times, it was the worst of times, it was the age of wisdom, it was the age of foolishness.